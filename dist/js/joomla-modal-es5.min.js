function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function e(t) {
  return (e = "function" == typeof Symbol && "symbol" == _typeof(Symbol.iterator) ? function (e) {
    return _typeof(e);
  } : function (e) {
    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : _typeof(e);
  })(t);
}

function t(e, t) {
  for (var i = 0; i < t.length; i++) {
    var o = t[i];
    o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, o.key, o);
  }
}

function i(t, i) {
  return !i || "object" !== e(i) && "function" != typeof i ? function (e) {
    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    return e;
  }(t) : i;
}

function o(e) {
  var t = "function" == typeof Map ? new Map() : void 0;
  return (o = function o(e) {
    if (null === e || (i = e, -1 === Function.toString.call(i).indexOf("[native code]"))) return e;
    var i;
    if ("function" != typeof e) throw new TypeError("Super expression must either be null or a function");

    if (void 0 !== t) {
      if (t.has(e)) return t.get(e);
      t.set(e, o);
    }

    function o() {
      return n(e, arguments, a(this).constructor);
    }

    return o.prototype = Object.create(e.prototype, {
      constructor: {
        value: o,
        enumerable: !1,
        writable: !0,
        configurable: !0
      }
    }), s(o, e);
  })(e);
}

function n(e, t, i) {
  return (n = r() ? Reflect.construct : function (e, t, i) {
    var o = [null];
    o.push.apply(o, t);
    var n = new (Function.bind.apply(e, o))();
    return i && s(n, i.prototype), n;
  }).apply(null, arguments);
}

function r() {
  if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
  if (Reflect.construct.sham) return !1;
  if ("function" == typeof Proxy) return !0;

  try {
    return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})), !0;
  } catch (e) {
    return !1;
  }
}

function s(e, t) {
  return (s = Object.setPrototypeOf || function (e, t) {
    return e.__proto__ = t, e;
  })(e, t);
}

function a(e) {
  return (a = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) {
    return e.__proto__ || Object.getPrototypeOf(e);
  })(e);
}

var l = 9,
    c = 27;
customElements.define("joomla-modal", function (e) {
  !function (e, t) {
    if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function");
    e.prototype = Object.create(t && t.prototype, {
      constructor: {
        value: e,
        writable: !0,
        configurable: !0
      }
    }), t && s(e, t);
  }(p, o(HTMLElement));
  var n,
      u,
      h,
      d,
      f,
      m = (n = p, u = r(), function () {
    var e,
        t = a(n);

    if (u) {
      var o = a(this).constructor;
      e = Reflect.construct(t, arguments, o);
    } else e = t.apply(this, arguments);

    return i(this, e);
  });

  function p() {
    var e;
    return function (e, t) {
      if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function");
    }(this, p), (e = m.call(this)).triggerBtn = "", e.focusableElements = null, e.focusableSelectors = ["a[href]", "area[href]", "input:not([disabled])", "select:not([disabled])", "textarea:not([disabled])", "button:not([disabled])", "iframe", "object", "embed", "[contenteditable]", '[tabindex]:not([tabindex^="-"])'], e.container = e.querySelector(".joomla-modal-dialog"), e;
  }

  return h = p, f = [{
    key: "observedAttributes",
    get: function get() {
      return ["width", "height", "innerWidth", "innerHeight", "iframe"];
    }
  }], (d = [{
    key: "connectedCallback",
    value: function value() {
      if (!this.id) throw new Error("`Joomla-modal` requires an id");

      if (this.title = this.getAttribute("title") || "Modal", this.setAttribute("role", "dialog"), this.classList.add("fade"), this.iframe = this.getAttribute("iframe") || "", this.width = this.getAttribute("width") || "100%", this.height = this.getAttribute("height") || "600px", !this.container) {
        var e = document.createElement("div");
        e.classList.add("joomla-modal-dialog"), e.setAttribute("role", "document"), e.innerHTML = this.innerHTML, this.innerHTML = "", this.appendChild(e), this.container = this.querySelector(".joomla-modal-dialog");
      }

      this.header = this.querySelector("header"), this.main = this.querySelector("section"), this.footer = this.querySelector("footer"), this.setAttribute("tabindex", -1);
      var t = "modal-title-".concat(new Date().getUTCMilliseconds());

      if (this.setAttribute("aria-labelledby", t), !this.header) {
        var i = document.createElement("h5");
        i.innerText = this.title, i.id = t;
        var o = document.createElement("button");
        o.setAttribute("aria-label", "Close"), o.setAttribute("data-dismiss", ""), o.innerHTML = '<span aria-hidden="true">Ã—</span>';
        var n = document.createElement("header");
        n.appendChild(i), n.appendChild(o), this.container.insertAdjacentElement("afterbegin", n);
      }

      this.header = this.container.querySelector("header"), this.body = this.container.querySelector("section"), this.footer = this.container.querySelector("footer"), this.triggerBtn = document.querySelector('[data-href="#'.concat(this.id, '"]')), this.triggerBtn && this.triggerBtn.addEventListener("click", this.open.bind(this));
    }
  }, {
    key: "disconnectedCallback",
    value: function value() {
      this.triggerBtn && this.triggerBtn.removeEventListener("click", this.open);
    }
  }, {
    key: "open",
    value: function value() {
      var e = this,
          t = document.createElement("div");

      if (t.classList.add("modal-backdrop", "fade"), t.classList.add("modal-backdrop", "show"), document.body.appendChild(t), this.removeAttribute("aria-hidden"), this.body && (this.iframeEl = this.main.querySelector("iframe"), this.iframe)) {
        this.iframeEl && this.iframeEl.parentNode.remove(this.iframeEl);
        var i = document.createElement("iframe");
        i.width = this.width, i.height = this.height, i.src = this.iframe, i.setAttribute("frameborder", 0), this.body.appendChild(i), this.iframeEl = this.main.querySelector("iframe");
      }

      this.adjustDimensions(), this.scrollTop = 0, this.classList.add("show"), this.focusableElements = [].slice.call(this.querySelectorAll(this.focusableSelectors.join())), this.focusableElements.length ? this.focusableElements[0].focus() : this.header.querySelector("button").focus(), this.evKeypress = this.keyPress.bind(this), this.evClose = this.close.bind(this), this.evDocumentClose = this.documentClose.bind(this), this.addEventListener("keydown", this.evKeypress), document.addEventListener("click", this.evDocumentClose), [].slice.call(this.querySelectorAll("[data-dismiss]")).forEach(function (t) {
        t.addEventListener("click", e.evClose);
      });
    }
  }, {
    key: "close",
    value: function value() {
      var e = this;
      this.removeEventListener("keydown", this.evKeypress), document.removeEventListener("click", this.evDocumentClose), [].slice.call(this.querySelectorAll("[data-dismiss]")).forEach(function (t) {
        t.removeEventListener("click", e.evClose);
      });
      var t = document.querySelector(".modal-backdrop");
      t && document.body.removeChild(t), this.setAttribute("aria-hidden", "true"), this.classList.remove("show"), this.main.innerHTML = "", this.triggerBtn.focus();
    }
  }, {
    key: "documentClose",
    value: function value(e) {
      this.findAncestorByClass(e.target, "joomla-modal-dialog") || e.target === this.triggerBtn || this.close();
    }
  }, {
    key: "keyPress",
    value: function value(e) {
      if (e.keyCode === c && this.close(), e.keyCode === l) {
        var t = this.focusableElements.indexOf(document.activeElement);
        !e.shiftKey || 0 !== t && -1 !== t || (this.focusableElements[this.focusableElements.length - 1].focus(), e.preventDefault()), e.shiftKey || t !== this.focusableElements.length - 1 || (this.focusableElements[0].focus(), e.preventDefault());
      }
    }
  }, {
    key: "adjustDimensions",
    value: function value() {
      var e = this.offsetHeight;
      e += parseInt(window.getComputedStyle(this).getPropertyValue("margin-top"), 10), e += parseInt(window.getComputedStyle(this).getPropertyValue("margin-bottom"), 10);
      var t = this.body.getBoundingClientRect.height,
          i = this.body.offsetHeight;
      i += parseInt(window.getComputedStyle(this.body).getPropertyValue("margin-top"), 10), i += parseInt(window.getComputedStyle(this.body).getPropertyValue("margin-bottom"), 10);
      var o = this.header.offsetHeight;
      o += parseInt(window.getComputedStyle(this.header).getPropertyValue("margin-top"), 10), o += parseInt(window.getComputedStyle(this.header).getPropertyValue("margin-bottom"), 10);
      var n = this.footer.offsetHeight;
      n += parseInt(window.getComputedStyle(this.footer).getPropertyValue("margin-top"), 10), n += parseInt(window.getComputedStyle(this.footer).getPropertyValue("margin-bottom"), 10);
      var r = this.offsetTop,
          s = window.height - 2 * r,
          a = i - t,
          l = s - (o + n + a);
      this.iframeEl ? this.iframeEl.getBoundingClientRect().height > l && (this.container.style.maxHeight = l, this.container.style.overflowY = "auto", this.iframeEl.style.maxHeight = l - a) : e > s && (this.container.style.maxHeight = l, this.container.style.overflowY = "auto");
    }
  }, {
    key: "findAncestorByClass",
    value: function value(e, t) {
      for (; (e = e.parentElement) && !e.classList.contains(t);) {
        ;
      }

      return e;
    }
  }]) && t(h.prototype, d), f && t(h, f), p;
}());
