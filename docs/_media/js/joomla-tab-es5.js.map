{"version":3,"file":"joomla-tab-es5.js","sources":["../../../src/js/tab/tab.js"],"sourcesContent":["(() => {\n  customElements.define('joomla-tab', class extends HTMLElement {\n    /* Attributes to monitor */\n    static get observedAttributes() { return ['recall', 'orientation', 'view']; }\n\n    get recall() { return this.getAttribute('recall'); }\n\n    get view() { return this.getAttribute('view'); }\n\n    set view(value) { this.setAttribute('view', value); }\n\n    get orientation() { return this.getAttribute('orientation'); }\n\n    set orientation(value) { this.setAttribute('orientation', value); }\n\n    /* Lifecycle, element created */\n    constructor() {\n      super();\n\n      this.hasActive = false;\n      this.currentActive = '';\n      this.hasNested = false;\n      this.isNested = false;\n      this.tabs = [];\n    }\n\n    /* Lifecycle, element appended to the DOM */\n    connectedCallback() {\n      if (!this.orientation || (this.orientation && ['horizontal', 'vertical'].indexOf(this.orientation) === -1)) {\n        this.orientation = 'horizontal';\n      }\n\n      // get tab elements\n      const self = this;\n      const tabs = [].slice.call(this.querySelectorAll('section'));\n      let tabsEl = [];\n      const tabLinkHash = [];\n\n      // Sanity check\n      if (!tabs) {\n        return;\n      }\n\n      if (this.parentNode.closest('joomla-tab')) {\n        this.isNested = true;\n      }\n\n      if (this.querySelector('joomla-tab')) {\n        this.hasNested = true;\n      }\n\n      // Use the sessionStorage state!\n      if (this.hasAttribute('recall')) {\n        const href = sessionStorage.getItem(this.getStorageKey());\n        if (href) {\n          tabLinkHash.push(href);\n        }\n      }\n\n      if (this.hasNested) {\n        // @todo use the recall attribute\n        const href = sessionStorage.getItem(this.getStorageKey());\n        if (href) {\n          tabLinkHash.push(href);\n        }\n        // @todo end\n\n        // Add possible parent tab to the aray for activation\n        if (tabLinkHash.length && tabLinkHash[0] !== '') {\n          const hash = tabLinkHash[0].substring(5);\n          const element = this.querySelector(`#${hash}`);\n\n          // Add the parent tab to the array for activation\n          if (element) {\n            const currentTabSet = element.closest('joomla-tab');\n\n            if (this.isNested) {\n              const parentTab = currentTabSet.closest('section');\n\n              if (parentTab) {\n                tabLinkHash.push(`#tab-${parentTab.id}`);\n              }\n            }\n          }\n        }\n\n        // remove the cascaded tabs and activate the right tab\n        tabs.forEach((tab) => {\n          if (tabLinkHash.length) {\n            const theId = `#tab-${tab.id}`;\n\n            if (tabLinkHash.indexOf(theId) === -1) {\n              tab.removeAttribute('active');\n            } else {\n              tab.setAttribute('active', '');\n            }\n          }\n\n          if (tab.parentNode === self) {\n            tabsEl.push(tab);\n          }\n        });\n      } else {\n        // Activate the correct tab\n        tabs.forEach((tab) => {\n          if (tabLinkHash.length) {\n            const theId = `#tab-${tab.id}`;\n            if (tabLinkHash.indexOf(theId) === -1) {\n              tab.removeAttribute('active');\n            } else {\n              tab.setAttribute('active', '');\n            }\n          }\n        });\n\n        tabsEl = tabs;\n      }\n\n      // Create the navigation\n      if (this.view !== 'accordion') {\n        this.createNavigation(tabsEl);\n      }\n\n      // Add missing role\n      tabsEl.forEach((tab) => {\n        tab.setAttribute('role', 'tabpanel');\n        this.tabs.push(`#tab-${tab.id}`);\n        if (tab.hasAttribute('active')) {\n          this.hasActive = true;\n          this.currentActive = tab.id;\n          this.querySelector(`#tab-${tab.id}`).setAttribute('aria-selected', 'true');\n          this.querySelector(`#tab-${tab.id}`).setAttribute('active', '');\n          this.querySelector(`#tab-${tab.id}`).setAttribute('tabindex', '0');\n        }\n      });\n\n      // Fallback if no active tab\n      if (!this.hasActive) {\n        tabsEl[0].setAttribute('active', '');\n        tabsEl[0].removeAttribute('aria-hidden');\n        this.hasActive = true;\n        this.currentActive = tabsEl[0].id;\n        this.querySelector(`#tab-${tabsEl[0].id}`).setAttribute('aria-selected', 'true');\n        this.querySelector(`#tab-${tabsEl[0].id}`).setAttribute('tabindex', '0');\n        this.querySelector(`#tab-${tabsEl[0].id}`).setAttribute('active', '');\n      }\n\n      // Check if there is a hash in the URI\n      if (window.location.href.match(/#\\S[^&]*/)) {\n        const hash = window.location.href.match(/#\\S[^&]*/);\n        const element = this.querySelector(hash[0]);\n\n        if (element) {\n          // Activate any parent tabs (nested tables)\n          const currentTabSet = element.closest('joomla-tab');\n\n          if (this.isNested) {\n            const parentTabSet = currentTabSet.closest('joomla-tab');\n            const parentTab = currentTabSet.closest('section');\n            parentTabSet.showTab(parentTab);\n            // Now activate the given tab\n            this.show(element);\n          } else {\n            // Now activate the given tab\n            this.showTab(element);\n          }\n        }\n      }\n\n      // Convert tabs to accordian\n      self.checkView(self);\n      window.addEventListener('resize', () => {\n        self.checkView(self);\n      });\n    }\n\n    /* Lifecycle, element removed from the DOM */\n    disconnectedCallback() {\n      const ulEl = this.querySelector('ul');\n      const navigation = [].slice.call(ulEl.querySelectorAll('a'));\n\n      navigation.forEach((link) => {\n        link.removeEventListener('click', this);\n      });\n      ulEl.removeEventListener('keydown', this);\n    }\n\n    /* Method to create the tabs navigation */\n    createNavigation(tabs) {\n      if (this.firstElementChild.nodeName.toLowerCase() === 'ul') {\n        return;\n      }\n\n      const nav = document.createElement('ul');\n      nav.setAttribute('role', 'tablist');\n\n      /** Activate Tab */\n      const activateTabFromLink = (e) => {\n        e.preventDefault();\n\n        // Doing toggle for accordion\n        const justHide = this.view === 'accordion' && e.target.hasAttribute('active');\n\n        if (this.hasActive) {\n          this.hideCurrent();\n\n          if (justHide) {\n            this.hasActive = false;\n            return;\n          }\n        }\n\n        const currentTabLink = this.currentActive;\n\n        // Set the selected tab as active\n        // Emit show event\n        this.dispatchCustomEvent('joomla.tab.show', e.target, this.querySelector(`#tab-${currentTabLink}`));\n        e.target.setAttribute('active', '');\n        e.target.setAttribute('aria-selected', 'true');\n        e.target.setAttribute('tabindex', '0');\n        this.querySelector(e.target.hash).setAttribute('active', '');\n        this.querySelector(e.target.hash).removeAttribute('aria-hidden');\n        this.currentActive = e.target.hash.substring(1);\n        // Emit shown event\n        this.dispatchCustomEvent('joomla.tab.shown', e.target, this.querySelector(`#tab-${currentTabLink}`));\n        this.saveState(`#tab-${e.target.hash.substring(1)}`);\n        this.hasActive = true;\n      };\n\n      tabs.forEach((tab) => {\n        if (!tab.id) {\n          return;\n        }\n\n        const active = tab.hasAttribute('active');\n        const liElement = document.createElement('li');\n        const aElement = document.createElement('a');\n\n        liElement.setAttribute('role', 'presentation');\n        aElement.setAttribute('role', 'tab');\n        aElement.setAttribute('aria-controls', tab.id);\n        aElement.setAttribute('aria-selected', active ? 'true' : 'false');\n        aElement.setAttribute('tabindex', active ? '0' : '-1');\n        aElement.setAttribute('href', `#${tab.id}`);\n        aElement.setAttribute('id', `tab-${tab.id}`);\n        aElement.innerHTML = tab.getAttribute('name');\n\n        if (active) {\n          aElement.setAttribute('active', '');\n        }\n\n        aElement.addEventListener('click', activateTabFromLink);\n\n        liElement.appendChild(aElement);\n        nav.appendChild(liElement);\n\n        tab.setAttribute('aria-labelledby', `tab-${tab.id}`);\n        if (!active) {\n          tab.setAttribute('aria-hidden', 'true');\n        }\n      });\n\n      this.insertAdjacentElement('afterbegin', nav);\n\n      // Keyboard access\n      this.addKeyListeners();\n    }\n\n    hideCurrent() {\n      // Unset the current active tab\n      if (this.currentActive) {\n        // Emit hide event\n        const el = this.querySelector(`a[aria-controls=\"${this.currentActive}\"]`);\n        this.dispatchCustomEvent('joomla.tab.hide', el, this.querySelector(`#tab-${this.currentActive}`));\n        el.removeAttribute('active');\n        el.setAttribute('tabindex', '-1');\n        this.querySelector(`#${this.currentActive}`).removeAttribute('active');\n        this.querySelector(`#${this.currentActive}`).setAttribute('aria-hidden', 'true');\n        el.removeAttribute('aria-selected');\n        // Emit hidden event\n        this.dispatchCustomEvent('joomla.tab.hidden', el, this.querySelector(`#tab-${this.currentActive}`));\n      }\n    }\n\n    showTab(tab) {\n      const tabLink = document.querySelector(`#tab-${tab.id}`);\n      tabLink.click();\n    }\n\n    show(ulLink) {\n      ulLink.click();\n    }\n\n    addKeyListeners() {\n      const keyBehaviour = (e) => {\n        // collect tab targets, and their parents' prev/next (or first/last)\n        const currentTab = this.querySelector(`#tab-${this.currentActive}`);\n        // const tablist = [].slice.call(this.querySelector('ul').querySelectorAll('a'));\n\n        const previousTabItem = currentTab.parentNode.previousElementSibling\n          || currentTab.parentNode.parentNode.lastElementChild;\n        const nextTabItem = currentTab.parentNode.nextElementSibling\n          || currentTab.parentNode.parentNode.firstElementChild;\n\n        // don't catch key events when ⌘ or Alt modifier is present\n        if (e.metaKey || e.altKey) {\n          return;\n        }\n\n        if (this.tabs.indexOf(`#${document.activeElement.id}`) === -1) {\n          return;\n        }\n\n        // catch left/right and up/down arrow key events\n        switch (e.keyCode) {\n          case 37:\n          case 38:\n            previousTabItem.querySelector('a').click();\n            previousTabItem.querySelector('a').focus();\n            e.preventDefault();\n            break;\n          case 39:\n          case 40:\n            nextTabItem.querySelector('a').click();\n            nextTabItem.querySelector('a').focus();\n            e.preventDefault();\n            break;\n          default:\n            break;\n        }\n      };\n      this.querySelector('ul').addEventListener('keyup', keyBehaviour);\n    }\n\n    getStorageKey() {\n      return window.location.href.toString().split(window.location.host)[1].replace(/&return=[a-zA-Z0-9%]+/, '').split('#')[0];\n    }\n\n    saveState(value) {\n      const storageKey = this.getStorageKey();\n      sessionStorage.setItem(storageKey, value);\n    }\n\n    /** Method to convert tabs to accordion and vice versa depending on screen size */\n    checkView(element) {\n      const el = element;\n      const nav = el.querySelector('ul');\n      const tabsEl = [];\n      if (document.body.getBoundingClientRect().width > 920) {\n        if (this.view === 'tabs') {\n          return;\n        }\n        el.view = 'tabs';\n        // convert to tabs\n        const panels = [].slice.call(nav.querySelectorAll('section'));\n\n        // remove the cascaded tabs\n        for (let i = 0, l = panels.length; i < l; ++i) {\n          if (panels[i].parentNode.parentNode.parentNode === el) {\n            tabsEl.push(panels[i]);\n          }\n        }\n\n        if (tabsEl.length) {\n          tabsEl.forEach((panel) => {\n            el.appendChild(panel);\n          });\n        }\n      } else {\n        if (this.view === 'accordion') {\n          return;\n        }\n        el.view = 'accordion';\n\n        // convert to accordion\n        const panels = [].slice.call(el.querySelectorAll('section'));\n\n        // remove the cascaded tabs\n        for (let i = 0, l = panels.length; i < l; ++i) {\n          if (panels[i].parentNode === el) {\n            tabsEl.push(panels[i]);\n          }\n        }\n\n        if (tabsEl.length) {\n          tabsEl.forEach((panel) => {\n            const link = el.querySelector(`a[aria-controls=\"${panel.id}\"]`);\n            if (link.parentNode.parentNode === el.firstElementChild) {\n              link.parentNode.appendChild(panel);\n            }\n          });\n        }\n      }\n    }\n\n    /* Method to dispatch events */\n    dispatchCustomEvent(eventName, element, related) {\n      const OriginalCustomEvent = new CustomEvent(eventName, { bubbles: true, cancelable: true });\n      OriginalCustomEvent.relatedTarget = related;\n      element.dispatchEvent(OriginalCustomEvent);\n      element.removeEventListener(eventName, element);\n    }\n  });\n})();\n"],"names":["customElements","define","getAttribute","value","setAttribute","hasActive","currentActive","hasNested","isNested","tabs","orientation","indexOf","self","slice","call","querySelectorAll","tabsEl","tabLinkHash","parentNode","closest","querySelector","hasAttribute","href","sessionStorage","getItem","getStorageKey","push","length","hash","substring","element","currentTabSet","parentTab","id","forEach","tab","theId","removeAttribute","view","createNavigation","window","location","match","parentTabSet","showTab","show","checkView","addEventListener","ulEl","navigation","link","removeEventListener","firstElementChild","nodeName","toLowerCase","nav","document","createElement","activateTabFromLink","e","preventDefault","justHide","target","hideCurrent","currentTabLink","dispatchCustomEvent","saveState","active","liElement","aElement","innerHTML","appendChild","insertAdjacentElement","addKeyListeners","el","tabLink","click","ulLink","keyBehaviour","currentTab","previousTabItem","previousElementSibling","lastElementChild","nextTabItem","nextElementSibling","metaKey","altKey","activeElement","keyCode","focus","toString","split","host","replace","storageKey","setItem","body","getBoundingClientRect","width","panels","i","l","panel","eventName","related","OriginalCustomEvent","CustomEvent","bubbles","cancelable","relatedTarget","dispatchEvent","HTMLElement"],"mappings":"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"}