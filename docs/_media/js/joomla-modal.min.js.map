{"version":3,"file":"joomla-modal.min.js","sources":["../../../src/js/modal/modal.js"],"sourcesContent":["(() => {\n  // Keycodes\n  const KEYCODE = {\n    TAB: 9,\n    ESC: 27,\n  };\n\n  customElements.define('joomla-modal', class extends HTMLElement {\n    constructor() {\n      super();\n\n      this.triggerBtn = '';\n      this.focusableElements = null;\n      this.focusableSelectors = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])'];\n      this.container = this.querySelector('.joomla-modal-dialog');\n    }\n\n    static get observedAttributes() {\n      return ['width', 'height', 'innerWidth', 'innerHeight', 'iframe'];\n    }\n\n    connectedCallback() {\n      if (!this.id) {\n        throw new Error('`Joomla-modal` requires an id');\n      }\n\n      this.title = this.getAttribute('title') || 'Modal';\n      this.setAttribute('role', 'dialog');\n      this.classList.add('fade');\n      this.iframe = this.getAttribute('iframe') || '';\n      this.width = this.getAttribute('width') || '100%';\n      this.height = this.getAttribute('height') || '600px';\n\n      if (!this.container) {\n        const cont = document.createElement('div');\n        cont.classList.add('joomla-modal-dialog');\n        cont.setAttribute('role', 'document');\n        cont.innerHTML = this.innerHTML;\n        this.innerHTML = '';\n        this.appendChild(cont);\n        this.container = this.querySelector('.joomla-modal-dialog');\n      }\n\n      this.header = this.querySelector('header');\n      this.main = this.querySelector('section');\n      this.footer = this.querySelector('footer');\n\n      this.setAttribute('tabindex', -1);\n\n      // Unique Id\n      const randomId = `modal-title-${new Date().getUTCMilliseconds()}`;\n      this.setAttribute('aria-labelledby', randomId);\n\n      if (!this.header) {\n        const htag = document.createElement('h5');\n        htag.innerText = this.title;\n        htag.id = randomId;\n        const closeButton = document.createElement('button');\n        closeButton.setAttribute('aria-label', 'Close');\n        closeButton.setAttribute('data-dismiss', '');\n        closeButton.innerHTML = '<span aria-hidden=\"true\">Ã—</span>';\n\n        const header = document.createElement('header');\n\n        header.appendChild(htag);\n        header.appendChild(closeButton);\n\n        this.container.insertAdjacentElement('afterbegin', header);\n      }\n      this.header = this.container.querySelector('header');\n      this.body = this.container.querySelector('section');\n      this.footer = this.container.querySelector('footer');\n\n      this.triggerBtn = document.querySelector(`[data-href=\"#${this.id}\"]`);\n      if (this.triggerBtn) {\n        this.triggerBtn.addEventListener('click', this.open.bind(this));\n      }\n    }\n\n    disconnectedCallback() {\n      if (this.triggerBtn) {\n        this.triggerBtn.removeEventListener('click', this.open);\n      }\n    }\n\n    open() {\n      const dropShadow = document.createElement('div');\n      dropShadow.classList.add('modal-backdrop', 'fade');\n      dropShadow.classList.add('modal-backdrop', 'show');\n      document.body.appendChild(dropShadow);\n\n      this.removeAttribute('aria-hidden');\n      // Iframe specific code, reload\n      if (this.body) {\n        this.iframeEl = this.main.querySelector('iframe');\n        if (this.iframe) {\n          if (this.iframeEl) {\n            this.iframeEl.parentNode.remove(this.iframeEl);\n          }\n          const newIframe = document.createElement('iframe');\n          newIframe.width = this.width;\n          newIframe.height = this.height;\n          newIframe.src = this.iframe;\n          newIframe.setAttribute('frameborder', 0);\n          this.body.appendChild(newIframe);\n          this.iframeEl = this.main.querySelector('iframe');\n        }\n      }\n\n      // Adjust the dimensions\n      this.adjustDimensions();\n\n      this.scrollTop = 0;\n      this.classList.add('show');\n\n      this.focusableElements = [].slice.call(this.querySelectorAll(this.focusableSelectors.join()));\n      if (this.focusableElements.length) {\n        this.focusableElements[0].focus();\n      } else {\n        this.header.querySelector('button').focus();\n      }\n\n      this.evKeypress = this.keyPress.bind(this);\n      this.evClose = this.close.bind(this);\n      this.evDocumentClose = this.documentClose.bind(this);\n\n      // Keyboard handling\n      this.addEventListener('keydown', this.evKeypress);\n\n      // Close on click outside the modal\n      document.addEventListener('click', this.evDocumentClose);\n\n      // Is there a close button?\n      const modalButtons = [].slice.call(this.querySelectorAll('[data-dismiss]'));\n      // Add listeners for close\n      modalButtons.forEach((modalButton) => {\n        modalButton.addEventListener('click', this.evClose);\n      });\n    }\n\n    close() {\n      this.removeEventListener('keydown', this.evKeypress);\n      document.removeEventListener('click', this.evDocumentClose);\n\n      // Is there a close button?\n      const modalButtons = [].slice.call(this.querySelectorAll('[data-dismiss]'));\n      // Add listeners for close\n      modalButtons.forEach((modalButton) => {\n        modalButton.removeEventListener('click', this.evClose);\n      });\n\n      const dropShadow = document.querySelector('.modal-backdrop');\n      if (dropShadow) document.body.removeChild(dropShadow);\n      this.setAttribute('aria-hidden', 'true');\n      this.classList.remove('show');\n      this.main.innerHTML = '';\n      this.triggerBtn.focus();\n    }\n\n    documentClose(event) {\n      if (!this.findAncestorByClass(event.target, 'joomla-modal-dialog') && event.target !== this.triggerBtn) {\n        this.close();\n      }\n    }\n\n    keyPress(e) {\n      // ESC key\n      if (e.keyCode === KEYCODE.ESC) {\n        this.close();\n      }\n      // TAB key\n      if (e.keyCode === KEYCODE.TAB) {\n        // this.handleTabEvent(e);\n        // Get the index of the current active element within the modal\n        const focusedIndex = this.focusableElements.indexOf(document.activeElement);\n        // Handle TAB event if need to skip\n        // If first element is focused and shift key is in use\n        if (e.shiftKey && (focusedIndex === 0 || focusedIndex === -1)) {\n          // Focus last item within modal\n          this.focusableElements[this.focusableElements.length - 1].focus();\n          e.preventDefault();\n        }\n        // If last element is focused and shift key is not in use\n        if (!e.shiftKey && focusedIndex === this.focusableElements.length - 1) {\n          // Focus first item within modal\n          this.focusableElements[0].focus();\n          e.preventDefault();\n        }\n      }\n    }\n\n    adjustDimensions() {\n      // Legacy code\n      // Height\n      let modalHeight = this.offsetHeight;\n      modalHeight += parseInt(window.getComputedStyle(this).getPropertyValue('margin-top'), 10);\n      modalHeight += parseInt(window.getComputedStyle(this).getPropertyValue('margin-bottom'), 10);\n\n      const bodyHeight = this.body.getBoundingClientRect.height;\n      let bodyHeightOuter = this.body.offsetHeight;\n      bodyHeightOuter += parseInt(window.getComputedStyle(this.body).getPropertyValue('margin-top'), 10);\n      bodyHeightOuter += parseInt(window.getComputedStyle(this.body).getPropertyValue('margin-bottom'), 10);\n\n      let headerHeight = this.header.offsetHeight;\n      headerHeight += parseInt(window.getComputedStyle(this.header).getPropertyValue('margin-top'), 10);\n      headerHeight += parseInt(window.getComputedStyle(this.header).getPropertyValue('margin-bottom'), 10);\n\n      let footerHeight = this.footer.offsetHeight;\n      footerHeight += parseInt(window.getComputedStyle(this.footer).getPropertyValue('margin-top'), 10);\n      footerHeight += parseInt(window.getComputedStyle(this.footer).getPropertyValue('margin-bottom'), 10);\n\n      const padding = this.offsetTop;\n      const maxModalHeight = window.height - (padding * 2);\n      const modalBodyPadding = (bodyHeightOuter - bodyHeight);\n      const maxModalBodyHeight = maxModalHeight - (headerHeight + footerHeight + modalBodyPadding);\n\n      if (this.iframeEl) {\n        const iframeHeight = this.iframeEl.getBoundingClientRect().height;\n\n        if (iframeHeight > maxModalBodyHeight) {\n          this.container.style.maxHeight = maxModalBodyHeight;\n          this.container.style.overflowY = 'auto';\n          this.iframeEl.style.maxHeight = maxModalBodyHeight - modalBodyPadding;\n        }\n      } else if (modalHeight > maxModalHeight) {\n        this.container.style.maxHeight = maxModalBodyHeight;\n        this.container.style.overflowY = 'auto';\n      }\n    }\n\n    /* eslint-disable */\n    findAncestorByClass(el, className) {\n      while ((el = el.parentElement) && !el.classList.contains(className));\n      return el;\n    }\n    /* eslint-enable */\n  });\n})();\n"],"names":["KEYCODE","customElements","define","HTMLElement","[object Object]","super","this","triggerBtn","focusableElements","focusableSelectors","container","querySelector","observedAttributes","id","Error","title","getAttribute","setAttribute","classList","add","iframe","width","height","cont","document","createElement","innerHTML","appendChild","header","main","footer","randomId","Date","getUTCMilliseconds","htag","innerText","closeButton","insertAdjacentElement","body","addEventListener","open","bind","removeEventListener","dropShadow","removeAttribute","iframeEl","parentNode","remove","newIframe","src","adjustDimensions","scrollTop","slice","call","querySelectorAll","join","length","focus","evKeypress","keyPress","evClose","close","evDocumentClose","documentClose","forEach","modalButton","removeChild","event","findAncestorByClass","target","e","keyCode","focusedIndex","indexOf","activeElement","shiftKey","preventDefault","modalHeight","offsetHeight","parseInt","window","getComputedStyle","getPropertyValue","bodyHeight","getBoundingClientRect","bodyHeightOuter","headerHeight","footerHeight","padding","offsetTop","maxModalHeight","modalBodyPadding","maxModalBodyHeight","style","maxHeight","overflowY","el","className","parentElement","contains"],"mappings":"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"}