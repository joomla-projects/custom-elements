{"version":3,"file":"joomla-panels-es5.js","sources":["../../../src/js/panels/panels.js"],"sourcesContent":["(() => {\n  customElements.define('joomla-panels', class extends HTMLElement {\n    /* Attributes to monitor */\n    static get observedAttributes() { return ['recall', 'orientation', 'view', 'responsive', 'collapse-width']; }\n\n    get recall() { return this.getAttribute('recall'); }\n\n    set recall(value) { return this.setAttribute('recall', value); }\n\n    get view() { return this.getAttribute('view'); }\n\n    set view(value) { this.setAttribute('view', value); }\n\n    get orientation() { return this.getAttribute('orientation') || 'horizontal'; }\n\n    set orientation(value) { this.setAttribute('orientation', value); }\n\n    get responsive() { return this.getAttribute('responsive'); }\n\n    set responsive(value) { this.setAttribute('responsive', value); }\n\n    get collapseWidth() { return this.getAttribute('collapse-width'); }\n\n    set collapseWidth(value) { this.setAttribute('collapse-width', value); }\n\n    /* Lifecycle, element created */\n    constructor() {\n      super();\n\n      // Setup configuration\n      this.hasActive = false;\n      this.currentActive = '';\n      this.hasNested = false;\n      this.isNested = false;\n      this.tabs = [];\n      this.tabsLinks = [];\n      this.panels = [];\n      this.tabLinkHash = [];\n    }\n\n    /* Lifecycle, element appended to the DOM */\n    connectedCallback() {\n      if (!this.orientation || (this.orientation && ['horizontal', 'vertical'].indexOf(this.orientation) === -1)) {\n        this.setAttribute('orientation', 'horizontal');\n      }\n\n      this.view = this.getAttribute('view') || 'tabs';\n      this.recall = this.recall || 'false';\n      this.responsive = this.getAttribute('responsive') || 'false';\n      this.collapseWidth = this.getAttribute('collapseWidth') || 0;\n\n      // Get tab elements\n      this.panels = [].slice.call(this.querySelectorAll('section'));\n\n      // Sanity check\n      if (!this.panels.length) {\n        throw new Error('`Joomla-panels` require one ore more panels!');\n      }\n\n      // Is this nested\n      if (this.findAncestorByTagNme(this, 'joomla-tab')) {\n        this.isNested = true;\n      }\n\n      // Does it have child tab element\n      if (this.querySelector('joomla-tab')) {\n        this.hasNested = true;\n      }\n\n      // Use the sessionStorage state!\n      if (this.recall) {\n        const href = sessionStorage.getItem(this.getStorageKey());\n        // Do not fail on 3.x tab state values hack\n        if (href && !/@\\[/.test(href)) {\n          this.tabLinkHash.push(href);\n        }\n        this.setTabState();\n      }\n\n      // Create the navigation\n      if (this.firstElementChild.tagName !== 'ul') {\n        this.createNavigation();\n      }\n\n      // Add missing A11Y\n      this.panels.forEach((tab) => {\n        tab.setAttribute('role', 'tabpanel');\n        this.tabs.push(`#tab-${tab.id}`);\n        if (tab.hasAttribute('active')) {\n          this.hasActive = true;\n          this.currentActive = tab.id;\n          this.querySelector(`#tab-${tab.id}`).setAttribute('aria-selected', 'true');\n          this.querySelector(`#tab-${tab.id}`).setAttribute('active', '');\n          this.querySelector(`#tab-${tab.id}`).setAttribute('tabindex', '0');\n        }\n      });\n\n      // Fallback if no active tab\n      if (!this.hasActive) {\n        this.tabsLinks[0].setAttribute('active', '');\n        this.hasActive = true;\n        this.currentActive = this.panels[0].id;\n        this.tabsLinks[0].setAttribute('aria-selected', 'true');\n        this.tabsLinks[0].setAttribute('tabindex', '0');\n        this.tabsLinks[0].setAttribute('active', '');\n        this.panels[0].setAttribute('active', '');\n      }\n\n      // Check if there is a hash in the URI\n      if (window.location.href.match(/#tab-/)) {\n        // this.activateUriHash();\n      }\n\n      if (this.view === 'accordion') {\n        this.toAccordion.bind(this)();\n      }\n\n      if (this.responsive === 'true') {\n        // Convert tabs to accordian and vice versa\n        this.changeView.bind(this);\n\n        // Add behavior for window size change\n        window.addEventListener('resize', this.changeView.bind(this));\n      }\n    }\n\n    /* Lifecycle, element removed from the DOM */\n    disconnectedCallback() {\n      const self = this;\n      const ulEl = this.querySelector('ul');\n      const navigation = [].slice.call(ulEl.querySelectorAll('a'));\n\n      navigation.forEach((link) => {\n        link.removeEventListener('click', self.activateTabFromLink, true);\n      });\n\n      ulEl.removeEventListener('keydown', self.keyBehaviour, true);\n    }\n\n    /* Method to create the tabs navigation */\n    createNavigation() {\n      const self = this;\n      let nav = '';\n\n      if (this.firstElementChild.tagName.toLowerCase() !== 'ul') {\n        nav = document.createElement('ul');\n      }\n\n      nav.setAttribute('role', 'tablist');\n      this.panels.forEach((panel) => {\n        if (!panel.id) {\n          throw new Error('`joomla-panels` All panels require an ID');\n        }\n\n        if (panel.parentNode !== this) {\n          return;\n        }\n\n        const active = panel.getAttribute('active') || false;\n        const liElement = document.createElement('li');\n        const aElement = document.createElement('a');\n\n        liElement.setAttribute('role', 'presentation');\n        aElement.setAttribute('role', 'tab');\n        aElement.setAttribute('aria-controls', panel.id);\n        aElement.setAttribute('aria-selected', active ? 'true' : 'false');\n        aElement.setAttribute('tabindex', active ? '0' : '-1');\n        aElement.setAttribute('href', `#${panel.id}`);\n        aElement.setAttribute('id', `tab-${panel.id}`);\n        aElement.innerHTML = panel.getAttribute('name');\n\n        if (active) {\n          aElement.setAttribute('active', '');\n        }\n\n        aElement.addEventListener('click', self.activateTabFromLink.bind(self));\n        this.tabsLinks.push(aElement);\n\n        liElement.append(aElement);\n        nav.append(liElement);\n\n        panel.setAttribute('aria-labelledby', `tab-${panel.id}`);\n\n        if (!active) {\n          panel.setAttribute('aria-hidden', 'true');\n        }\n      });\n\n      this.insertAdjacentElement('afterbegin', nav);\n\n      // Keyboard access\n      this.querySelector('ul').addEventListener('keydown', this.keyBehaviour.bind(this));\n    }\n\n    hideCurrent() {\n      // Unset the current active tab\n      if (this.currentActive) {\n        // Emit hide event\n        const el = this.querySelector(`a[aria-controls=\"${this.currentActive}\"]`);\n        this.dispatchCustomEvent('joomla.tab.hide', el, this.querySelector(`#tab-${this.currentActive}`));\n        el.removeAttribute('active');\n        el.setAttribute('tabindex', '-1');\n        this.querySelector(`#${this.currentActive}`).removeAttribute('active');\n        this.querySelector(`#${this.currentActive}`).setAttribute('aria-hidden', 'true');\n        el.removeAttribute('aria-selected');\n        // Emit hidden event\n        this.dispatchCustomEvent('joomla.tab.hidden', el, this.querySelector(`#tab-${this.currentActive}`));\n      }\n    }\n\n    /** Activate Tab */\n    activateTabFromLink(e) {\n      e.preventDefault();\n      const currentTabLink = this.currentActive;\n\n      if (this.hasActive) {\n        this.hideCurrent();\n      }\n\n      // Set the selected tab as active\n      // Emit show event\n      this.dispatchCustomEvent('joomla.tab.show', e.target, this.querySelector(`#tab-${currentTabLink}`));\n      e.target.setAttribute('active', '');\n      e.target.setAttribute('aria-selected', 'true');\n      e.target.setAttribute('tabindex', '0');\n      this.querySelector(e.target.hash).setAttribute('active', '');\n      this.querySelector(e.target.hash).removeAttribute('aria-hidden');\n      this.currentActive = e.target.hash.substring(1);\n      // Emit shown event\n      this.dispatchCustomEvent('joomla.tab.shown', e.target, this.querySelector(`#tab-${currentTabLink}`));\n      this.saveState(`#tab-${e.target.hash.substring(1)}`);\n    }\n\n    showTab(tab) {\n      const tabLink = document.querySelector(`#tab-${tab.id}`);\n      tabLink.click();\n    }\n\n    show(ulLink) {\n      ulLink.click();\n    }\n\n    keyBehaviour(e) {\n      // collect tab targets, and their parents' prev/next (or first/last)\n      const currentTab = this.querySelector(`#tab-${this.currentActive}`);\n\n      const previousTabItem = currentTab.parentNode.previousElementSibling\n        || currentTab.parentNode.parentNode.lastElementChild;\n      const nextTabItem = currentTab.parentNode.nextElementSibling\n        || currentTab.parentNode.parentNode.firstElementChild;\n\n      // Don't catch key events when âŒ˜ or Alt modifier is present\n      if (e.metaKey || e.altKey) {\n        return;\n      }\n\n      if (this.tabs.indexOf(`#${document.activeElement.id}`) === -1) {\n        return;\n      }\n\n      // catch left/right and up/down arrow key events\n      switch (e.keyCode) {\n        case 37:\n        case 38:\n          e.preventDefault();\n          e.stopPropagation();\n          previousTabItem.querySelector('a').click();\n          previousTabItem.querySelector('a').focus();\n          break;\n        case 39:\n        case 40:\n          e.preventDefault();\n          e.stopPropagation();\n          nextTabItem.querySelector('a').click();\n          nextTabItem.querySelector('a').focus();\n          break;\n        default:\n          break;\n      }\n    }\n\n    /* eslint-disable */\n    getStorageKey() {\n      return window.location.href.toString().split(window.location.host)[1].replace(/&return=[a-zA-Z0-9%]+/, '').split('#')[0];\n    }\n    /* eslint-disable */\n\n    saveState(value) {\n      const storageKey = this.getStorageKey();\n      sessionStorage.setItem(storageKey, value);\n    }\n\n    setTabState() {\n      const self = this;\n      const tabs = this.tabsLinks;\n\n      if (this.hasNested) {\n        // Add possible parent tab to the aray for activation\n        if (this.tabLinkHash.length && this.tabLinkHash[0] !== '') {\n          const hash = this.tabLinkHash[0].substring(5);\n          const element = this.querySelector(`${hash}`);\n\n          // Add the parent tab to the array for activation\n          if (element) {\n            const currentTabSet = this.findAncestorByTagNme(element, 'joomla-tab');\n            const parentTabSet = this.findAncestorByTagNme(currentTabSet, 'joomla-tab');\n\n            if (parentTabSet) {\n              const parentTab = this.findAncestorByTagNme(currentTabSet, 'section');\n              if (parentTab) {\n                this.tabLinkHash.push(`#tab-${parentTab.id}`);\n              }\n            }\n          }\n        }\n\n        // Remove the cascaded tabs and activate the right tab\n        tabs.forEach((tab) => {\n          if (this.tabLinkHash.length) {\n            const theId = `#tab-${tab.id}`;\n\n            if (this.tabLinkHash.indexOf(theId) === -1) {\n              tab.removeAttribute('active');\n            } else {\n              tab.setAttribute('active', '');\n            }\n          }\n\n          if (tab.parentNode === self) {\n            this.tabsLinks.push(tab);\n          }\n        });\n      } else {\n        // Activate the correct tab\n        tabs.forEach((tab) => {\n          if (this.tabLinkHash.length) {\n            const theId = `#tab-${tab.hash}`;\n            if (this.tabLinkHash.indexOf(theId) > -1) {\n              tab.removeAttribute('active');\n            } else {\n              tab.setAttribute('active', '');\n            }\n          }\n        });\n\n        this.tabsLinks = tabs;\n      }\n    }\n\n    toTabs() {\n      const self = this;\n      // remove the cascaded tabs\n      for (let i = 0, l = this.panels.length; i < l; ++i) {\n        if (this.panels[i].parentNode.parentNode.parentNode === this) {\n          this.tabsLinks.push(this.panels[i]);\n        }\n      }\n\n      if (this.tabsLinks.length) {\n        this.tabsLinks.forEach((panel) => {\n          self.appendChild(panel);\n        });\n      }\n    }\n\n    toAccordion() {\n      const self = this;\n      // remove the cascaded tabs\n      // for (let i = 0, l = this.panels.length; i < l; ++i) {\n      //   if (this.panels[i].parentNode === this) {\n      //     this.tabsLinks.push(this.panels[i]);\n      //   }\n      // }\n\n      if (this.panels.length) {\n        this.panels.forEach((panel) => {\n          const link = self.querySelector('a[aria-controls=\"' + panel.id + '\"]')\n          // if (link.parentNode.parentNode === self.firstElementChild)\n          link.parentNode.appendChild(panel);\n        });\n      }\n    }\n\n    /** Method to convert tabs to accordion and vice versa depending on screen size */\n    changeView() {\n      if (window.outerWidth > 920) {\n        if (this.view === 'tabs') {\n          return;\n        }\n        // convert to tabs\n        this.toTabs.bind(this);\n        this.view = 'tabs'\n      } else {\n        if (this.view === 'accordion') {\n          return;\n        }\n        // convert to accordion\n        this.toAccordion.bind(this);\n        this.view = 'accordion'\n      }\n    }\n\n    activateUriHash() {\n      const hash = window.location.href.match(/#\\S[^&]*/);\n      const element = this.querySelector(hash[0]);\n\n      if (element) {\n        // Activate any parent tabs (nested tables)\n        const currentTabSet = this.findAncestorByTagNme(element, 'joomla-tab');\n        const parentTabSet = this.findAncestorByTagNme(currentTabSet, 'joomla-tab');\n\n        if (parentTabSet) {\n          const parentTab = this.findAncestorByTagNme(currentTabSet, 'section');\n          parentTabSet.showTab(parentTab);\n          // Now activate the given tab\n          this.show(element);\n        } else {\n          // Now activate the given tab\n          this.showTab(element);\n        }\n      }\n    }\n    /* eslint-disable */\n    findAncestorByTagNme(el, tagName) {\n      while ((el = el.parentElement) && el.nodeName.toLowerCase() !== tagName);\n      return el;\n    }\n    /* eslint-enable */\n\n    /* Method to dispatch events */\n    dispatchCustomEvent(eventName, element, related) {\n      const OriginalCustomEvent = new CustomEvent(eventName, { bubbles: true, cancelable: true });\n      if (related) {\n        OriginalCustomEvent.relatedTarget = related;\n      }\n\n      element.dispatchEvent(OriginalCustomEvent);\n      element.removeEventListener(eventName, element);\n    }\n  });\n})();\n"],"names":["customElements","define","getAttribute","value","setAttribute","hasActive","currentActive","hasNested","isNested","tabs","tabsLinks","panels","tabLinkHash","orientation","indexOf","view","recall","responsive","collapseWidth","slice","call","querySelectorAll","length","Error","findAncestorByTagNme","querySelector","href","sessionStorage","getItem","getStorageKey","test","push","setTabState","firstElementChild","tagName","createNavigation","forEach","tab","id","hasAttribute","window","location","match","toAccordion","bind","changeView","addEventListener","self","ulEl","navigation","link","removeEventListener","activateTabFromLink","keyBehaviour","nav","toLowerCase","document","createElement","panel","parentNode","active","liElement","aElement","innerHTML","append","insertAdjacentElement","el","dispatchCustomEvent","removeAttribute","e","preventDefault","currentTabLink","hideCurrent","target","hash","substring","saveState","tabLink","click","ulLink","currentTab","previousTabItem","previousElementSibling","lastElementChild","nextTabItem","nextElementSibling","metaKey","altKey","activeElement","keyCode","stopPropagation","focus","toString","split","host","replace","storageKey","setItem","element","currentTabSet","parentTabSet","parentTab","theId","i","l","appendChild","outerWidth","toTabs","showTab","show","parentElement","nodeName","eventName","related","OriginalCustomEvent","CustomEvent","bubbles","cancelable","relatedTarget","dispatchEvent","HTMLElement"],"mappings":"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"}