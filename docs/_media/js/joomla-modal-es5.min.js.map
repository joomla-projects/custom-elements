{"version":3,"file":"joomla-modal-es5.min.js","sources":["../../../src/js/modal/modal.js"],"sourcesContent":["(() => {\n  // Keycodes\n  const KEYCODE = {\n    TAB: 9,\n    ESC: 27,\n  };\n\n  customElements.define('joomla-modal', class extends HTMLElement {\n    constructor() {\n      super();\n\n      this.triggerBtn = '';\n      this.focusableElements = null;\n      this.focusableSelectors = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])'];\n      this.container = this.querySelector('.joomla-modal-dialog');\n    }\n\n    static get observedAttributes() {\n      return ['width', 'height', 'innerWidth', 'innerHeight', 'iframe'];\n    }\n\n    connectedCallback() {\n      if (!this.id) {\n        throw new Error('`Joomla-modal` requires an id');\n      }\n\n      this.title = this.getAttribute('title') || 'Modal';\n      this.setAttribute('role', 'dialog');\n      this.classList.add('fade');\n      this.iframe = this.getAttribute('iframe') || '';\n      this.width = this.getAttribute('width') || '100%';\n      this.height = this.getAttribute('height') || '600px';\n\n      if (!this.container) {\n        const cont = document.createElement('div');\n        cont.classList.add('joomla-modal-dialog');\n        cont.setAttribute('role', 'document');\n        cont.innerHTML = this.innerHTML;\n        this.innerHTML = '';\n        this.appendChild(cont);\n        this.container = this.querySelector('.joomla-modal-dialog');\n      }\n\n      this.header = this.querySelector('header');\n      this.main = this.querySelector('section');\n      this.footer = this.querySelector('footer');\n\n      this.setAttribute('tabindex', -1);\n\n      // Unique Id\n      const randomId = `modal-title-${new Date().getUTCMilliseconds()}`;\n      this.setAttribute('aria-labelledby', randomId);\n\n      if (!this.header) {\n        const htag = document.createElement('h5');\n        htag.innerText = this.title;\n        htag.id = randomId;\n        const closeButton = document.createElement('button');\n        closeButton.setAttribute('aria-label', 'Close');\n        closeButton.setAttribute('data-dismiss', '');\n        closeButton.innerHTML = '<span aria-hidden=\"true\">Ã—</span>';\n\n        const header = document.createElement('header');\n\n        header.appendChild(htag);\n        header.appendChild(closeButton);\n\n        this.container.insertAdjacentElement('afterbegin', header);\n      }\n      this.header = this.container.querySelector('header');\n      this.body = this.container.querySelector('section');\n      this.footer = this.container.querySelector('footer');\n\n      this.triggerBtn = document.querySelector(`[data-href=\"#${this.id}\"]`);\n      if (this.triggerBtn) {\n        this.triggerBtn.addEventListener('click', this.open.bind(this));\n      }\n    }\n\n    disconnectedCallback() {\n      if (this.triggerBtn) {\n        this.triggerBtn.removeEventListener('click', this.open);\n      }\n    }\n\n    open() {\n      const dropShadow = document.createElement('div');\n      dropShadow.classList.add('modal-backdrop', 'fade');\n      dropShadow.classList.add('modal-backdrop', 'show');\n      document.body.appendChild(dropShadow);\n\n      this.removeAttribute('aria-hidden');\n      // Iframe specific code, reload\n      if (this.body) {\n        this.iframeEl = this.main.querySelector('iframe');\n        if (this.iframe) {\n          if (this.iframeEl) {\n            this.iframeEl.parentNode.remove(this.iframeEl);\n          }\n          const newIframe = document.createElement('iframe');\n          newIframe.width = this.width;\n          newIframe.height = this.height;\n          newIframe.src = this.iframe;\n          newIframe.setAttribute('frameborder', 0);\n          this.body.appendChild(newIframe);\n          this.iframeEl = this.main.querySelector('iframe');\n        }\n      }\n\n      // Adjust the dimensions\n      this.adjustDimensions();\n\n      this.scrollTop = 0;\n      this.classList.add('show');\n\n      this.focusableElements = [].slice.call(this.querySelectorAll(this.focusableSelectors.join()));\n      if (this.focusableElements.length) {\n        this.focusableElements[0].focus();\n      } else {\n        this.header.querySelector('button').focus();\n      }\n\n      this.evKeypress = this.keyPress.bind(this);\n      this.evClose = this.close.bind(this);\n      this.evDocumentClose = this.documentClose.bind(this);\n\n      // Keyboard handling\n      this.addEventListener('keydown', this.evKeypress);\n\n      // Close on click outside the modal\n      document.addEventListener('click', this.evDocumentClose);\n\n      // Is there a close button?\n      const modalButtons = [].slice.call(this.querySelectorAll('[data-dismiss]'));\n      // Add listeners for close\n      modalButtons.forEach((modalButton) => {\n        modalButton.addEventListener('click', this.evClose);\n      });\n    }\n\n    close() {\n      this.removeEventListener('keydown', this.evKeypress);\n      document.removeEventListener('click', this.evDocumentClose);\n\n      // Is there a close button?\n      const modalButtons = [].slice.call(this.querySelectorAll('[data-dismiss]'));\n      // Add listeners for close\n      modalButtons.forEach((modalButton) => {\n        modalButton.removeEventListener('click', this.evClose);\n      });\n\n      const dropShadow = document.querySelector('.modal-backdrop');\n      if (dropShadow) document.body.removeChild(dropShadow);\n      this.setAttribute('aria-hidden', 'true');\n      this.classList.remove('show');\n      this.main.innerHTML = '';\n      this.triggerBtn.focus();\n    }\n\n    documentClose(event) {\n      if (!this.findAncestorByClass(event.target, 'joomla-modal-dialog') && event.target !== this.triggerBtn) {\n        this.close();\n      }\n    }\n\n    keyPress(e) {\n      // ESC key\n      if (e.keyCode === KEYCODE.ESC) {\n        this.close();\n      }\n      // TAB key\n      if (e.keyCode === KEYCODE.TAB) {\n        // this.handleTabEvent(e);\n        // Get the index of the current active element within the modal\n        const focusedIndex = this.focusableElements.indexOf(document.activeElement);\n        // Handle TAB event if need to skip\n        // If first element is focused and shift key is in use\n        if (e.shiftKey && (focusedIndex === 0 || focusedIndex === -1)) {\n          // Focus last item within modal\n          this.focusableElements[this.focusableElements.length - 1].focus();\n          e.preventDefault();\n        }\n        // If last element is focused and shift key is not in use\n        if (!e.shiftKey && focusedIndex === this.focusableElements.length - 1) {\n          // Focus first item within modal\n          this.focusableElements[0].focus();\n          e.preventDefault();\n        }\n      }\n    }\n\n    adjustDimensions() {\n      // Legacy code\n      // Height\n      let modalHeight = this.offsetHeight;\n      modalHeight += parseInt(window.getComputedStyle(this).getPropertyValue('margin-top'), 10);\n      modalHeight += parseInt(window.getComputedStyle(this).getPropertyValue('margin-bottom'), 10);\n\n      const bodyHeight = this.body.getBoundingClientRect.height;\n      let bodyHeightOuter = this.body.offsetHeight;\n      bodyHeightOuter += parseInt(window.getComputedStyle(this.body).getPropertyValue('margin-top'), 10);\n      bodyHeightOuter += parseInt(window.getComputedStyle(this.body).getPropertyValue('margin-bottom'), 10);\n\n      let headerHeight = this.header.offsetHeight;\n      headerHeight += parseInt(window.getComputedStyle(this.header).getPropertyValue('margin-top'), 10);\n      headerHeight += parseInt(window.getComputedStyle(this.header).getPropertyValue('margin-bottom'), 10);\n\n      let footerHeight = this.footer.offsetHeight;\n      footerHeight += parseInt(window.getComputedStyle(this.footer).getPropertyValue('margin-top'), 10);\n      footerHeight += parseInt(window.getComputedStyle(this.footer).getPropertyValue('margin-bottom'), 10);\n\n      const padding = this.offsetTop;\n      const maxModalHeight = window.height - (padding * 2);\n      const modalBodyPadding = (bodyHeightOuter - bodyHeight);\n      const maxModalBodyHeight = maxModalHeight - (headerHeight + footerHeight + modalBodyPadding);\n\n      if (this.iframeEl) {\n        const iframeHeight = this.iframeEl.getBoundingClientRect().height;\n\n        if (iframeHeight > maxModalBodyHeight) {\n          this.container.style.maxHeight = maxModalBodyHeight;\n          this.container.style.overflowY = 'auto';\n          this.iframeEl.style.maxHeight = maxModalBodyHeight - modalBodyPadding;\n        }\n      } else if (modalHeight > maxModalHeight) {\n        this.container.style.maxHeight = maxModalBodyHeight;\n        this.container.style.overflowY = 'auto';\n      }\n    }\n\n    /* eslint-disable */\n    findAncestorByClass(el, className) {\n      while ((el = el.parentElement) && !el.classList.contains(className));\n      return el;\n    }\n    /* eslint-enable */\n  });\n})();\n"],"names":["KEYCODE","customElements","define","HTMLElement","triggerBtn","focusableElements","focusableSelectors","container","_this","querySelector","this","id","Error","title","getAttribute","setAttribute","classList","add","iframe","width","height","cont","document","createElement","innerHTML","appendChild","header","main","footer","randomId","Date","getUTCMilliseconds","htag","innerText","closeButton","insertAdjacentElement","body","addEventListener","open","bind","removeEventListener","dropShadow","removeAttribute","iframeEl","parentNode","remove","newIframe","src","adjustDimensions","scrollTop","slice","call","querySelectorAll","join","length","focus","evKeypress","keyPress","evClose","close","evDocumentClose","documentClose","forEach","modalButton","_this2","_this3","removeChild","event","findAncestorByClass","target","e","keyCode","focusedIndex","indexOf","activeElement","shiftKey","preventDefault","modalHeight","offsetHeight","parseInt","window","getComputedStyle","getPropertyValue","bodyHeight","getBoundingClientRect","bodyHeightOuter","headerHeight","footerHeight","padding","offsetTop","maxModalHeight","modalBodyPadding","maxModalBodyHeight","style","maxHeight","overflowY","el","className","parentElement","contains"],"mappings":"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"}