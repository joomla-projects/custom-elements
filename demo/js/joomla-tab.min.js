class TabElement extends HTMLElement{static get observedAttributes(){return["recall","orientation","view"]}get recall(){return this.getAttribute("recall")}get view(){return this.getAttribute("view")}set view(t){this.setAttribute("view",t)}get orientation(){return this.getAttribute("orientation")}set orientation(t){this.setAttribute("oriendation",t)}constructor(){super(),this.includeCss(),this.hasActive=!1,this.currentActive=""}connectedCallback(){(!this.orientation||this.orientation&&-1===["horizontal","vertical"].indexOf(this.orientation))&&(this.orientation="horizontal");const t=[].slice.call(this.querySelectorAll("section"));if(t){if(this.createNavigation(t),t.forEach(t=>{t.setAttribute("role","tabpanel"),t.hasAttribute("active")&&(this.hasActive=!0,this.currentActive=t.id,this.querySelector(`#tab-${t.id}`).setAttribute("aria-selected","true"),this.querySelector(`#tab-${t.id}`).setAttribute("active",""),this.querySelector(`#tab-${t.id}`).setAttribute("tabindex","0"))}),this.hasActive||(t[0].setAttribute("active",""),this.hasActive=!0,this.currentActive=t[0].id,this.querySelector(`#tab-${t[0].id}`).setAttribute("aria-selected","true"),this.querySelector(`#tab-${t[0].id}`).setAttribute("tabindex","0"),this.querySelector(`#tab-${t[0].id}`).setAttribute("active","")),this.keyListeners(t),window.location.href.match(/#\S[^\&]*/)){const t=window.location.href.match(/#\S[^\&]*/),e=this.querySelector(t[0]);if(e){const t=this.findAncestor(e,"joomla-tab"),i=this.findAncestor(t,"joomla-tab");if(i){const r=this.findAncestor(t,"section");i.showTab(r),this.show(e)}else this.showTab(e)}}if(this.hasAttribute("recall")&&this.restoreState(),!this.querySelector("joomla-tab")){this.checkView(this);const t=this;window.addEventListener("resize",()=>{t.checkView(t)})}}}disconnectedCallback(){const t=this.querySelector("ul");[].slice.call(t.querySelectorAll("a")).forEach(function(t){t.removeEventListener("click",this)}),t.removeEventListener("keydown",this)}createNavigation(t){const e=document.createElement("ul");e.setAttribute("role","tablist");const i=t=>{t.preventDefault(),this.hasActive&&this.hideCurrent();const e=this.currentActive;this.dispatchCustomEvent("joomla.tab.show",t.target,this.querySelector(`#tab-${e}`)),t.target.setAttribute("active",""),t.target.setAttribute("aria-selected","true"),t.target.setAttribute("tabindex","0"),this.querySelector(t.target.hash).setAttribute("active",""),this.querySelector(t.target.hash).removeAttribute("aria-hidden"),this.currentActive=t.target.hash.substring(1),this.saveState(t.target.hash),this.dispatchCustomEvent("joomla.tab.shown",t.target,this.querySelector(`#tab-${e}`))};t.forEach(t=>{if(!t.id)return;const r=t.hasAttribute("active"),s=document.createElement("li"),a=document.createElement("a");s.setAttribute("role","presentation"),a.setAttribute("role","tab"),a.setAttribute("aria-controls",t.id),a.setAttribute("aria-selected",r?"true":"false"),a.setAttribute("tabindex",r?"0":"-1"),a.setAttribute("href",`#${t.id}`),a.setAttribute("id",`tab-${t.id}`),a.innerHTML=t.getAttribute("name"),r&&a.setAttribute("active",""),a.addEventListener("click",i),s.append(a),e.append(s),t.setAttribute("aria-labelledby",`tab-${t.id}`),r||t.setAttribute("aria-hidden","true")}),this.insertAdjacentElement("afterbegin",e)}hideCurrent(){if(this.currentActive){const t=this.querySelector(`a[aria-controls="${this.currentActive}"]`);this.dispatchCustomEvent("joomla.tab.hide",t,this.querySelector(`#tab-${this.currentActive}`)),t.removeAttribute("active"),t.setAttribute("tabindex","-1"),this.querySelector(`#${this.currentActive}`).removeAttribute("active"),this.querySelector(`#${this.currentActive}`).setAttribute("aria-hidden","true"),t.removeAttribute("aria-selected"),this.dispatchCustomEvent("joomla.tab.hidden",t,this.querySelector(`#tab-${this.currentActive}`))}}showTab(t){document.querySelector(`#tab-${t.id}`).click(),this.saveState(`#${t.id}`)}show(t){t.click(),this.saveState(t.hash)}keyListeners(){this.querySelector("ul").addEventListener("keydown",t=>{console.log(this.currentActive);const e=this.querySelector(`#tab-${this.currentActive}`),i=[].slice.call(this.querySelector("ul").querySelectorAll("a")),r=e.parentNode.previousElementSibling||i[i.length-1],s=e.parentNode.nextElementSibling||i[0];if(!t.metaKey&&!t.altKey)switch(t.keyCode){case 37:case 38:"li"!==r.tagName.toLowerCase()?(r.click(),r.focus(),this.saveState(r.hash)):(r.querySelector("a").click(),r.querySelector("a").focus(),this.saveState(r.hash)),t.preventDefault();break;case 39:case 40:"a"===s.tagName.toLowerCase()?(s.click(),s.focus(),this.saveState(s.hash)):(s.querySelector("a").click(),s.querySelector("a").focus(),this.saveState(s.hash)),t.preventDefault()}})}getStorageKey(){return window.location.href.toString().split(window.location.host)[1].replace(/&return=[a-zA-Z0-9%]+/,"").split("#")[0]}restoreState(){const t=sessionStorage.getItem(this.getStorageKey());if(t){const e=this.querySelector(t);if(e){const t=this.findAncestor(e,"joomla-tab"),i=this.findAncestor(t,"joomla-tab");if(i){const r=this.findAncestor(t,"section");i.showTab(r),this.show(e)}else this.showTab(e)}}}saveState(t){const e=this.getStorageKey();sessionStorage.setItem(e,t)}checkView(t){const e=t.querySelector("ul");document.body.getBoundingClientRect().width>920?(t.view="tabs",[].slice.call(e.querySelectorAll("section")).forEach(e=>{t.appendChild(e)})):(t.view="accordion",[].slice.call(t.querySelectorAll("section")).forEach(t=>{const i=t.id&&e.querySelector(`a[aria-controls="${t.id}"]`);i&&i.parentNode.appendChild(t)}))}findAncestor(t,e){for(;(t=t.parentElement)&&t.nodeName.toLowerCase()!==e;);return t}dispatchCustomEvent(t,e,i){const r=new CustomEvent(t,{bubbles:!0,cancelable:!0});r.relatedTarget=i,e.dispatchEvent(r),e.removeEventListener(t,e)}includeCss(){if(!document.getElementById("joomla-tab-stylesheet")){const t=document.createElement("style");t.id="joomla-tab-stylesheet",t.innerText="{{stylesheet}}",document.head.appendChild(t)}}}customElements.define("joomla-tab",TabElement);